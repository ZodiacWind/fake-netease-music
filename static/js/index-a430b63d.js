import{r as c,g as e,F as G,j as a,p as L,u as q}from"./react-7f918845.js";import{s as J}from"./collector.module-b0079d28.js";import{b as S,r as F,c as f,d as K,C as Q,e as R,f as V,t as X,h as Z,i as C,w as N,D as T,T as ss,j as as,k as es,l as ts,m as is}from"./index-b2307066.js";import{u as ls,a as ns}from"./react-redux-8df6583b.js";import{U as rs,k as cs,ai as os,h as x,$ as us,a2 as ms,D as ds,aj as g}from"./vendor-2e679db4.js";import{W as hs,s as ps}from"./write-comment-7cb6ba4c.js";import{C as bs}from"./index-79a50130.js";import"./lodash-44bc1aaf.js";import"./react-router-dom-102d9908.js";const Cs=({id:t})=>{const l=f("collector",J),[o,b]=c.exports.useState([]),[v,y]=c.exports.useState(0),[D,s]=c.exports.useState(1);async function h(i=1,u=20){const r=(i-1)*u,m=await K({id:t,offset:r,limit:u});b(m.subscribers),y(m.total)}return c.exports.useEffect(()=>{t&&h()},[t]),o.length>0?e(G,{children:[a("div",{className:l(),children:o.map(i=>e("div",{className:l("item"),children:[a(S,{className:l("img"),src:F(i.avatarUrl,100)}),e("div",{children:[a("div",{className:l("title"),children:i.nickname}),i.signature&&a("div",{className:l("subtitle"),children:i.signature})]})]},i.userId))}),a("footer",{className:l("footer"),children:a(rs,{current:D,total:v,onChange:(i,u)=>{s(i),h(i,u)},pageSize:100,showSizeChanger:!1})})]}):a("div",{className:l("empty"),children:"\u6682\u65E0\u6536\u85CF\u8005"})},Ns=({id:t,isAlbum:l})=>{const o=f("comments-list",ps);return e("div",{className:o(),children:[a(hs,{}),a(Q,{id:t,api:l?R:V})]})};var gs={"album-detail":"_album-detail_1r2oa_1","album-detail__title":"_album-detail__title_1r2oa_4"};const fs=({description:t})=>{const l=f("album-detail",gs);return e("div",{className:l(),children:[a("header",{className:l("title"),children:"\u4E13\u8F91\u4ECB\u7ECD"}),a("p",{children:t})]})},Ts=()=>{const t=f("list"),l=L(),[o,b]=c.exports.useState([]),v=ls(),[y,D]=c.exports.useState(""),[s,h]=c.exports.useState(),i=c.exports.useMemo(()=>Number(l.id),[l.id]),{push:u}=q(),r=c.exports.useMemo(()=>!!l.type,[l.type]),m=ns(n=>n.user.profile);function P(n=0){v(as({current:n,tracks:o,fm:[]}))}function k(n){u(T.user(n))}async function _(){const[n,B]=await Promise.all([es(i),ts(i)]),p=n.songs.map(d=>{var A;return d.disable=(A=d==null?void 0:d.privilege)!=null&&A.cp?!d.privilege.cp:!1,d});b(p);const{picUrl:E,name:j,artist:w,publishTime:M,description:W}=n.album,{subCount:$,shareCount:H,commentCount:O}=B,z={coverImgUrl:E,name:j,subscribedCount:$,shareCount:H,commentCount:O,createTime:M,artistName:w.name};h(z),D(W)}async function I(){const n=await is(i),B=n.playlist.tracks.map((p,E)=>(p.disable=!n.privileges[E].cp&&!p.pc,p));b(B),h(n.playlist)}function U(){var n;return e("div",{className:t("description"),children:[e("div",{className:t("tag"),children:[a("span",{className:"--title",children:"\u6807\u7B7E: "}),a("span",{children:(n=s==null?void 0:s.tags)==null?void 0:n.join("/")})]}),e("div",{className:t("count"),children:[e("span",{children:[a("span",{className:"--title",children:"\u6B4C\u66F2\u6570: "}),N(s==null?void 0:s.trackCount)]}),e("span",{className:"--left",children:[a("span",{className:"--title",children:"\u64AD\u653E\u6570: "}),N(s==null?void 0:s.playCount)]})]}),e("div",{className:t("introduction"),children:[a("span",{className:"--title",children:"\u7B80\u4ECB: "}),a("div",{children:s==null?void 0:s.description})]})]})}function Y(){return e("div",{className:t("description"),children:[e("div",{className:t("singer"),children:[a("span",{className:"--title",children:"\u6B4C\u624B: "}),a("span",{onClick:()=>u(T.singer(s==null?void 0:s.id)),children:s==null?void 0:s.artistName})]}),e("div",{className:t("publish-time"),children:[a("span",{className:"--title",children:"\u65F6\u95F4: "}),a("span",{children:x(s==null?void 0:s.createTime).format("YYYY-MM-DD")})]})]})}return c.exports.useEffect(()=>{Number.isNaN(i)||(r?_():I())},[i,r]),e("div",{className:t(),children:[e("header",{className:t("header"),children:[i&&(s==null?void 0:s.coverImgUrl)?a(S,{className:cs("list__img",{"--album":r}),src:F(s.coverImgUrl,300),alt:"avatar"}):a("div",{className:t("img-default"),children:a(os,{})}),e("div",{className:t("right"),children:[e("div",{className:t("title"),children:[a("span",{children:r?"\u4E13\u8F91":"\u6B4C\u5355"}),a("strong",{children:(s==null?void 0:s.name)||"\u6211\u559C\u6B22\u7684\u97F3\u4E50"})]}),!r&&e("div",{className:t("user-info"),children:[a("img",{src:X(F(m.avatarUrl||Z,100)),alt:"avatar",onClick:()=>k(m.userId)}),a("a",{onClick:()=>k(m.userId),children:m.nickname}),e("span",{children:[x(s==null?void 0:s.createTime).format("YYYY-MM-DD"),"\u521B\u5EFA"]})]}),e("div",{className:t("control"),children:[a(C,{compose:!0,onClick:()=>P()}),e(C,{children:[a(us,{}),"\u6536\u85CF(",N(s==null?void 0:s.subscribedCount),")"]}),e(C,{children:[a(ms,{}),"\u5206\u4EAB(",N((s==null?void 0:s.shareCount)||0),")"]}),e(C,{children:[a(ds,{}),"\u4E0B\u8F7D\u5168\u90E8"]})]}),r?Y():U()]})]}),a("section",{className:t("tabs"),children:e(g,{children:[a(g.TabPane,{tab:"\u6B4C\u66F2\u5217\u8868",children:a(ss,{columns:bs,data:o,onDoubleClick:P})},"1"),a(g.TabPane,{tab:`\u8BC4\u8BBA(${(s==null?void 0:s.commentCount)||0})`,children:a(Ns,{id:i,isAlbum:r})},"2"),a(g.TabPane,{tab:r?"\u4E13\u8F91\u8BE6\u60C5":"\u6536\u85CF\u8005",children:r?a(fs,{description:y}):a(Cs,{id:i})},"3")]})})]})};export{Ts as default};
