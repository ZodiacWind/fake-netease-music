import{r as t,g as C,F as G,j as s,u as R}from"./react-7f918845.js";import{al as b,am as A,an as D,c as P,D as T,ao as w}from"./index-b2307066.js";import{N as F}from"./index-f75fb157.js";import{L as M}from"./index-7ba1d90d.js";import{P as S}from"./index-f819dae0.js";import{ad as j,k as y}from"./vendor-2e679db4.js";import"./lodash-44bc1aaf.js";import"./react-router-dom-102d9908.js";import"./react-redux-8df6583b.js";function I(e){const[m,f]=t.exports.useState([]),r=t.exports.useMemo(()=>{const c=m.find(a=>a.id===e);return c?c.name:"\u5168\u90E8\u89C6\u9891"},[e]),i=C(G,{children:[r," ",s(j,{})]});async function v(){const c=await b();f(c.data)}return t.exports.useEffect(()=>{v()},[]),{videoGroupList:m,buttonContext:i}}function H(e){const[m,f]=t.exports.useReducer(L,[]),[r,i]=t.exports.useState(""),[v,c]=t.exports.useState(!0),a=t.exports.useRef(null);let h=0;const g=8;async function x(o=0){const u=e?await A(e,o):await D(o);c(u.hasmore);const p=u.datas.filter(d=>d.data.creator).map(d=>{const{vid:N,coverUrl:l,title:V,creator:k}=d.data,{nickname:E}=k;return{id:N,imgUrl:l,description:V,author:E}});f(o===0?{payload:p}:{type:"add",payload:p})}function L(o,{type:u="reset",payload:p}){return u==="add"?[...o,...p]:p}return t.exports.useEffect(()=>{x()},[e]),t.exports.useEffect(()=>{if(!a.current)return;const o=new IntersectionObserver(u=>{u[0].intersectionRatio<=0||(v?(i("\u52A0\u8F7D\u4E2D..."),h+=g,x(h)):i("\u6CA1\u6709\u66F4\u591A\u4E86~"))});return o.observe(a.current),()=>{a.current&&o.unobserve(a.current),o.disconnect()}},[]),{moreText:r,videoList:m,footerRef:a}}const X=()=>{const e=P("video"),[m,f]=t.exports.useState([]),[r,i]=t.exports.useState(0),{push:v}=R(),{buttonContext:c,videoGroupList:a}=I(r),{moreText:h,videoList:g,footerRef:x}=H(r);function L(n){v(T.playVideo(n))}function o(n){i(n)}async function u(){const n=await w();f(n.data.map(d=>({name:d.name,id:d.id})))}function p(n){function d(l){i(l),n(!1)}function N(){i(0),n(!1)}return C("div",{className:e("popover"),children:[s("header",{className:e("popover-header"),children:s("button",{className:y({["--active"]:!r}),onClick:N,children:"\u5168\u90E8\u89C6\u9891"})}),s("div",{className:e("popover-main"),children:a.map(l=>s("div",{children:s("span",{className:y({"--active":l.id===r}),onClick:()=>d(l.id),children:l.name})},l.id))})]})}return t.exports.useEffect(()=>{u()},[]),C("div",{className:e(),children:[C("header",{className:e("header"),children:[s(S,{context:c,functionChildren:p}),s(F,{id:r,data:m,onNavClick:o})]}),s(M,{data:g,onItemClick:L}),s("footer",{ref:x,className:e("footer"),children:h})]})};export{X as default};
