import{r as o,R as e,u as V}from"./react-69194784.js";import{ak as b,al as j,am as R,c as G,D as A,an as D}from"./index-a8385452.js";import{N as P}from"./index-9adb381a.js";import{L as T}from"./index-473f0355.js";import{P as w}from"./index-ef6e8539.js";import{ad as M,k as L}from"./vendor-441fcb21.js";import"./lodash-16b1923a.js";import"./react-router-dom-fbac4128.js";import"./react-redux-9f5c3214.js";function S(t){const[f,p]=o.exports.useState([]),r=o.exports.useMemo(()=>{const c=f.find(s=>s.id===t);return c?c.name:"\u5168\u90E8\u89C6\u9891"},[t]),i=e.createElement(e.Fragment,null,r," ",e.createElement(M,null));async function v(){const c=await b();p(c.data)}return o.exports.useEffect(()=>{v()},[]),{videoGroupList:f,buttonContext:i}}function F(t){const[f,p]=o.exports.useReducer(h,[]),[r,i]=o.exports.useState(""),[v,c]=o.exports.useState(!0),s=o.exports.useRef(null);let x=0;const C=8;async function E(a=0){const u=t?await j(t,a):await R(a);c(u.hasmore);const m=u.datas.filter(d=>d.data.creator).map(d=>{const{vid:g,coverUrl:l,title:y,creator:N}=d.data,{nickname:k}=N;return{id:g,imgUrl:l,description:y,author:k}});p(a===0?{payload:m}:{type:"add",payload:m})}function h(a,{type:u="reset",payload:m}){return u==="add"?[...a,...m]:m}return o.exports.useEffect(()=>{E()},[t]),o.exports.useEffect(()=>{if(!s.current)return;const a=new IntersectionObserver(u=>{u[0].intersectionRatio<=0||(v?(i("\u52A0\u8F7D\u4E2D..."),x+=C,E(x)):i("\u6CA1\u6709\u66F4\u591A\u4E86~"))});return a.observe(s.current),()=>{s.current&&a.unobserve(s.current),a.disconnect()}},[]),{moreText:r,videoList:f,footerRef:s}}const Q=()=>{const t=G("video"),[f,p]=o.exports.useState([]),[r,i]=o.exports.useState(0),{push:v}=V(),{buttonContext:c,videoGroupList:s}=S(r),{moreText:x,videoList:C,footerRef:E}=F(r);function h(n){v(A.playVideo(n))}function a(n){i(n)}async function u(){const n=await D();p(n.data.map(d=>({name:d.name,id:d.id})))}function m(n){function d(l){i(l),n(!1)}function g(){i(0),n(!1)}return e.createElement("div",{className:t("popover")},e.createElement("header",{className:t("popover-header")},e.createElement("button",{className:L({["--active"]:!r}),onClick:g},"\u5168\u90E8\u89C6\u9891")),e.createElement("div",{className:t("popover-main")},s.map(l=>e.createElement("div",{key:l.id},e.createElement("span",{className:L({"--active":l.id===r}),onClick:()=>d(l.id)},l.name)))))}return o.exports.useEffect(()=>{u()},[]),e.createElement("div",{className:t()},e.createElement("header",{className:t("header")},e.createElement(w,{context:c,functionChildren:m}),e.createElement(P,{id:r,data:f,onNavClick:a})),e.createElement(T,{data:C,onItemClick:h}),e.createElement("footer",{ref:E,className:t("footer")},x))};export{Q as default};
